<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nova Chat — Tam Sürüm</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00bfff">

<style>
/* === GENEL === */
body {
  margin: 9px;
  font-family: "Poppins", "Segoe UI", sans-serif;
  display: flex;
  flex-direction: row;
  height: 100vh;
  background: #a9e2f0;
  color: #ffffff;
  overflow: hidden;
  transition: background 0.3s, color 0.3s;
  scroll-behavior: smooth;
}

/* --- YAN MENÜ --- */
#sideMenu {
  width: 280px;
  min-width: 150px;
  max-width: 500px;
  background: #b8ddee;
  border-right: 2px solid #00bfff;
  display: flex;
  flex-direction: column;
  padding: 15px;
  overflow-y: auto;
  box-shadow: 2px 0 10px rgba(255, 255, 255, 0.1);
  transition: transform 0.3s ease;
  z-index: 1000;
}
#sideMenu h3 {
  margin: 0 0 15px 0;
  color: #08b3ec;
  font-size: 1.4rem;
  text-align: center;
  border-bottom: 1px solid #00bfff;
  padding-bottom: 8px;
}
#sideMenu button,
#sideMenu .chatRow button.chatBtn {
  margin: 5px 0;
  border: none;
  border-radius: 12px;
  padding: 12px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.4s;
  background: linear-gradient(45deg, #8be0ff, #00bfff);
  color: #494949;
  text-align: left;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 9px 6px rgba(0, 0, 0, 0.15);
}
#sideMenu button:hover {
  background: linear-gradient(45deg, #00bfff, #000000);
  color: #fff;
}

/* --- ANA ALAN --- */
#mainContent {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* --- ÜST KISIM --- */
header {
  text-align: center;
  padding: 15px;
  font-size: 1.5rem;
  font-weight: bold;
  color: #00080a;
  border-bottom: 2px solid #ffffff;
  background: #d7dde0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
header img {
  height: 40px;
  border-radius: 10px;
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
  margin-right: 8px;
}
#themeToggle {
  border: none;
  background: #12a8da;
  color: white;
  font-weight: bold;
  border-radius: 10px;
  padding: 8px 14px;
  cursor: pointer;
  transition: 0.3s;
}
#themeToggle:hover { background: #0099cc; }

/* --- MESAJLAR --- */
#chatsContainer {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  position: relative;
  padding: 10px;
  background: #c3d5eb;
}
.chatDiv {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  padding: 2px;
}
.msg {
  max-width: 80%;
  margin: 8px 0;
  padding: 16px 16px;
  border-radius: 16px;
  white-space: pre-wrap;
  word-wrap: break-word;
  font-size: 1rem;
  line-height: 1.4;
  position: relative;
  word-break: break-word;
  box-shadow: 0 1px 5px rgba(240, 5, 5, 0.05);
  animation: fadeIn 0.4s ease;
}
.msg .timestamp {
  font-size: 0.7rem;
  color: #370eee;
  position: absolute;
  bottom: -16px;
  right: 10px;
}
.user {
  background: #3949db;
  color: #f0f0f0;
  align-self: flex-end;
  margin-left: auto;
}
.nova {
  color: #111;
  margin-right: auto;
  background-color: rgb(177, 230, 255);
}

/* --- GİRİŞ ALANI --- */
#inputArea {
  display: flex;
  padding: 10px 15px;
  background: #98b6df;
  border-top: 1px solid #00bfff;
  gap: 5px;
  flex-wrap: wrap;
  box-shadow: 0 0 10px rgb(0, 110, 255);
}
#input {
  flex: 99;
  padding: 12px 16px;
  border-radius: 200px;
  border: 0.5px solid #ffffff;
  outline: none;
  font-size: 1rem;
  background: #2c2d2e;
  color: #fafafa;
  resize: none;
  box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.5);
}
button.sendBtn {
  padding: 10px 20px;
  border-radius: 100px;
  border: none;
  background: #1ebfff;
  color: rgb(255, 255, 255);
  font-weight: bold;
  cursor: pointer;
  transition: 0.4s;
  box-shadow: 5px 5px 5px black;
}
button.sendBtn:hover { background: #0400ff; }
button#stopBtn {
  background: #fa0000;
  color: white;
}
button#stopBtn:hover { background: #660303; }

/* --- KISA BUTONLAR --- */
#quickBtns {
  display: flex;
  gap: 5px;
  margin-top: 5px;
  flex-wrap: wrap;
}
#quickBtns button {
  padding: 6px 12px;
  border-radius: 8px;
  border: none;
  background: #91ff00;
  color: #000;
  cursor: pointer;
  font-weight: bold;
  box-shadow: 5px 5px 5px black;
  transition: all 0.3s;
}
#quickBtns button:hover { background: #ffdd00; }

/* --- EMOJİLER --- */
#emojiPicker {
  display: flex;
  gap: 5px;
  flex-wrap: wrap;
  margin-top: 5px;
}
#emojiPicker span {
  cursor: pointer;
  font-size: 1.3rem;
}

/* --- TOAST MESAJ --- */
#toast {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.8);
  color: rgb(255, 255, 255);
  padding: 10px 20px;
  border-radius: 10px;
  display: none;
  z-index: 2000;
}

/* --- Güncelleme Banner --- */
/* --- Güncelleme Banner Ortada --- */
#updateBanner {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #1a1a1a;
  color: #fff;
  padding: 20px 30px;
  border-radius: 12px;
  box-shadow: 0 0 20px rgba(0,0,0,0.5);
  display: none;
  z-index: 5000;
  text-align: center;
  width: 90%;
  max-width: 400px;
}

#updateBanner button {
  margin-top: 15px;
  padding: 12px 20px;
  border: none;
  border-radius: 10px;
  background: #00bfff;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
}

#updateBanner button:hover {
  background: #0088cc;
}

#updateProgress {
  width: 0%;
  height: 8px;
  background: #00ff00;
  border-radius: 4px;
  margin-top: 15px;
  transition: width 0.3s;
}

/* Changelog ekranı */
#changelogScreen {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #1a1a1a;
  color: #fff;
  padding: 20px 30px;
  border-radius: 12px;
  box-shadow: 0 0 20px rgba(0,0,0,0.5);
  display: none;
  z-index: 5000;
  text-align: center;
  width: 90%;
  max-width: 400px;
}

#changelogScreen button {
  margin-top: 15px;
  padding: 12px 20px;
  border: none;
  border-radius: 10px;
  background: #00bfff;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
}

#changelogScreen button:hover {
  background: #0088cc;
}

/* --- ANİMASYON --- */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px);}
  to { opacity: 1; transform: translateY(0);}
}
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

/* --- MOBİL TASARIM --- */
@media (max-width: 800px) {
  body { flex-direction: column; }
  #sideMenu { position: fixed; top: 0; left: 0; width: 80%; max-width: 300px; height: 100%; transform: translateX(-100%); transition: transform 0.3s ease; }
  #sideMenu.active { transform: translateX(0); }
  #mainContent { flex: 1; width: 100%; margin-left: 0; }
  #inputArea { flex-direction: column; gap: 8px; }
  #input, button.sendBtn, #stopBtn { width: 92%; border-radius: 150px; }
  header { font-size: 1.3rem; padding: 10px; }
  header img { height: 32px; }
}
img { border-radius: 30px; font-size: 40px; }
@media (max-width: 600px) {
  header { font-size: 1.1rem; }
  .msg { font-size: 0.9rem; padding: 10px 12px; }
  #inputArea { padding: 8px; }
}
</style>
</head>
<body>

<button style="color: #000000;background-color: #8280ff;color: #ffffff;" id="menuToggle">☰ Menü</button>

<div id="updateBanner">
  🚀 Nova'nın yeni sürümü var! <span id="latestVersionText"></span>
  <br>
  <button id="updateBtn">Güncelle</button>
  <div id="updateProgress"></div>
</div>

<div id="changelogScreen" style="display:none;">
  <div id="changelogContent00">
    <h1>Yeni Güncelleme !</h1>
    <h2>NoVa V4.1 </h2>
    <h4> Güncelleme Ekranı<br>Hatalar Düzeltildi</h4>
  </div>
  <button id="changelogOkBtn">Tamam</button>
</div>


<!-- Açılış Ekranı -->
<div id="splash-screen" style="
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:#a9e2f0; display:flex; align-items:center; justify-content:center;
  flex-direction:column; z-index:9999;
">
  <img src="icons/nova-192.png" style="width:100px; animation:spin 2s linear infinite;">
  <h2 style="color:white; margin-top:20px;">Nova Yükleniyor...</h2>
</div>

<div id="sideMenu">
<img src="ChatGPT Image 1 Kas 2025 12_57_42.png" alt="nova"
     style="width: 80%; max-width: 400px; height: auto; border-radius: 30px; display: block; margin: 0 auto;">

  <h3>💬 Nova Chat</h3>
  <button id="newChatBtn">➕ Yeni Sohbet</button>
  <div id="menu"></div>
  <button id="themeToggle">🌙 Tema Değiştir</button>
</div>
<div id="dragHandle"></div>

<div id="mainContent">
  <header>
    <div style="display:flex; align-items:center;">
      <img src="ChatGPT Image 1 Kas 2025 12_57_42.png" alt="Nova Logo">
      💬 Nova Chat
    </div>
    <span id="novaStatus">Hazır</span>
  </header>
  <div id="chatsContainer"></div>
  <div id="inputArea">
    <textarea id="input" placeholder="Ask The Nova..." autocomplete="off" rows="1"></textarea>
    <button type="button" class="sendBtn" id="sendBtn">↑</button>
    <button type="button" class="sendBtn" id="stopBtn">Durdur</button>
  </div>
  <div id="quickBtns">
    <button>Merhaba</button>
    <button>Nasılsın?</button>
    <button>Hava durumu</button>
  </div>
  <div id="emojiPicker"></div>
</div>

<div id="toast"></div>
<script>
// Açılış ekranı süresi
window.addEventListener('DOMContentLoaded', () => {
  setTimeout(()=>{
    document.getElementById('splash-screen').style.display='none';
    document.getElementById('nova-widget').style.display='block';
  },2000);
});
</script>

<script>
/* --- JavaScript kodu (hiç değiştirilmedi) --- */
const sideMenu = document.getElementById("sideMenu");
const menuToggle = document.getElementById("menuToggle");
const dragHandle = document.getElementById("dragHandle");
const chatsContainer = document.getElementById("chatsContainer");
const input = document.getElementById("input");
const sendBtn = document.getElementById("sendBtn");
const stopBtn = document.getElementById("stopBtn");
const menu = document.getElementById("menu");
const novaStatus = document.getElementById("novaStatus");
const quickBtns = document.getElementById("quickBtns");
const emojiPicker = document.getElementById("emojiPicker");
const newChatBtn = document.getElementById("newChatBtn");
const themeToggle = document.getElementById("themeToggle");
const toast = document.getElementById("toast");
const BACKEND_URL = 'https://nova-chat-d50f.onrender.com/api';

menuToggle.onclick = ()=>{ sideMenu.classList.toggle("active"); };

// Drag handle
let isResizing = false;
dragHandle.addEventListener("mousedown", e=>{ isResizing = true; document.body.style.cursor="col-resize"; });
document.addEventListener("mousemove", e=>{
  if(!isResizing) return;
  let newWidth = e.clientX;
  if(newWidth < 150) newWidth = 150;
  if(newWidth > 500) newWidth = 500;
  sideMenu.style.width = newWidth + "px";
});
document.addEventListener("mouseup", e=>{ if(isResizing){ isResizing=false; document.body.style.cursor="default"; } });

// Tema toggle
themeToggle.onclick = ()=>{ document.body.classList.toggle("light"); showToast("Tema değiştirildi"); };

function showToast(msg, duration=2000){
  toast.textContent = msg;
  toast.style.display = "block";
  setTimeout(()=>{ toast.style.display = "none"; }, duration);
}

// User setup
let userId = localStorage.getItem("nova_user_id");
if(!userId){ userId="user_"+Date.now()+"_"+Math.floor(Math.random()*10000); localStorage.setItem("nova_user_id",userId); }
let currentChat = localStorage.getItem("nova_last_chat") || "default";
let sending = false;
let userInfo = JSON.parse(localStorage.getItem("nova_user_info_"+userId)||"{}");

// Sanitize function (basit)
function sanitize(str){ const temp=document.createElement("div"); temp.textContent=str; return temp.innerHTML; }

function formatDate(d){ return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,'0')+"-"+String(d.getDate()).padStart(2,'0')+" "+String(d.getHours()).padStart(2,'0')+":"+String(d.getMinutes()).padStart(2,'0'); }

function renderMenu(){
  menu.innerHTML="";
  const voiceBtn = document.createElement("button");
  voiceBtn.textContent = "Sesli Mod";
  voiceBtn.onclick = () => { window.location.href = "sesli.html"; };
  menu.appendChild(voiceBtn);
  fetch(`${BACKEND_URL}/history?userId=${userId}`)
    .then(r=>r.json())
    .then(data=>{
      Object.keys(data).forEach(cid=>{
        const msgs = data[cid] || [];
        const lastMsg = msgs.length>0 ? msgs[msgs.length-1].text : "Yeni Sohbet";
        addChatToMenu(cid, lastMsg, true);
      });
    });
}

function addChatToMenu(chatId, lastMessage="Yeni Sohbet", skipSave=false){
  if([...menu.querySelectorAll(".chatBtn")].some(b=>b.dataset.id===chatId)) return;
  const row = document.createElement("div"); row.className="chatRow";
  const chatBtn = document.createElement("button"); chatBtn.className="chatBtn"; chatBtn.dataset.id=chatId; chatBtn.onclick=()=>{ loadChat(chatId); };
  const deleteBtn = document.createElement("button"); deleteBtn.className="deleteBtn"; deleteBtn.textContent="❌";
  deleteBtn.onclick = async ()=>{ if(confirm("Bu sohbeti silmek istediğine emin misin?")){ try{ const res = await fetch(`${BACKEND_URL}/delete_chat`,{ method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({userId, chatId}) }); const data = await res.json(); if(data.success){ row.remove(); const div = document.getElementById(chatId); if(div) div.remove(); if(currentChat===chatId) startNewChat(); }else showToast("Silme başarısız: "+(data.error||"")); } catch(err){ console.error(err); showToast("Silme sırasında hata!"); } } };
  row.appendChild(chatBtn); row.appendChild(deleteBtn); menu.appendChild(row); updateChatBtnLabel(chatBtn,lastMessage);
}

function updateChatBtnLabel(button,lastMessage){ if(lastMessage.length>20) lastMessage=lastMessage.slice(0,20)+"..."; button.textContent=lastMessage; }

function loadChat(cid){
  currentChat=cid; Array.from(chatsContainer.children).forEach(c=>c.style.display="none");
  let div=document.getElementById(cid);
  if(!div){ div=document.createElement("div"); div.className="chatDiv"; div.id=cid; chatsContainer.appendChild(div); }
  div.style.display="flex";
  fetch(`${BACKEND_URL}/history?userId=${userId}`)
    .then(r=>r.json())
    .then(data=>{ const msgs = data[cid]||[]; div.innerHTML=""; msgs.forEach(m=> addMessage(m.text,m.sender,div)); });
  localStorage.setItem("nova_last_chat",cid);
}

function startNewChat(){ const newId = "chat_"+Date.now()+"_"+Math.floor(Math.random()*10000); addChatToMenu(newId,"Yeni Sohbet"); loadChat(newId); }

newChatBtn.addEventListener("click", e=>{ e.preventDefault(); startNewChat(); });

function addMessage(text,sender,container=null){
  const parent = container || document.getElementById(currentChat);
  const div=document.createElement("div"); div.className="msg "+sender; div.innerHTML = sanitize(text);
  const timestamp=document.createElement("div"); timestamp.className="timestamp"; timestamp.textContent=formatDate(new Date());
  div.appendChild(timestamp); parent.appendChild(div); parent.scroll({top: parent.scrollHeight, behavior:"smooth"}); return div;
}

// Yazma efekti
async function addTypingMessage(text,sender,container=null,delay=5){
  const parent = container || document.getElementById(currentChat);
  const div=document.createElement("div"); div.className="msg "+sender;
  const timestamp=document.createElement("div"); timestamp.className="timestamp"; timestamp.textContent=formatDate(new Date());
  div.appendChild(timestamp); parent.appendChild(div); parent.scroll({top: parent.scrollHeight, behavior:"smooth"});
  for(let i=0;i<text.length;i++){ div.innerHTML = sanitize(text.slice(0,i+1)); parent.scroll({top: parent.scrollHeight, behavior:"smooth"}); await new Promise(r=>setTimeout(r,delay)); }
  return div;
}

async function sendMessage(msg=null){
  if(sending) return;
  sending=true;
  const text=msg||input.value.trim(); if(!text){sending=false;return;}
  input.value="";
  const chatDiv = document.getElementById(currentChat);
  addMessage(text,"user",chatDiv);
  const typingDiv=addMessage("Nova yazıyor...","nova",chatDiv);
  novaStatus.textContent="Nova yazıyor...";
  try{
    const resHist=await fetch(`${BACKEND_URL}/history?userId=${userId}`);
    const historyData=await resHist.json();
    const chatHistory=historyData[currentChat]||[];
    const res=await fetch(BACKEND_URL+"/chat",{ method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({userId,currentChat,message:text,userInfo,history:chatHistory}) });
    const data=await res.json();
    typingDiv.remove();
    await addTypingMessage(data.response||"⚠️ Hata","nova",chatDiv);
    if(data.updatedUserInfo){ userInfo=data.updatedUserInfo; localStorage.setItem("nova_user_info_"+userId,JSON.stringify(userInfo)); }
  }catch(err){ typingDiv.textContent="Bağlantı hatası 🚫"; console.error(err); }
  novaStatus.textContent="Hazır"; sending=false;
}

input.addEventListener("keydown", e=>{ if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); sendMessage(); } });
sendBtn.addEventListener("click", e=>{ e.preventDefault(); sendMessage(); });
stopBtn.addEventListener("click", e=>{ e.preventDefault(); });

emojiPicker.innerHTML=""; "😀😂😍😎🤔😢❤️🤖".split("").forEach(e=>{ const span=document.createElement("span"); span.textContent=e; span.onclick=()=>{ input.value+=e; input.focus(); }; emojiPicker.appendChild(span); });

quickBtns.querySelectorAll("button").forEach(b=>{ b.addEventListener("click", e=>{ e.preventDefault(); sendMessage(b.textContent); }); });

window.addEventListener("DOMContentLoaded", ()=>{ loadChat(currentChat); renderMenu(); });
// ----------------------------------------------------------------------------------------------
const CURRENT_VERSION = "4.1";
const LATEST_VERSION = "4.2";

const updateBanner = document.getElementById("updateBanner");
const updateBtn = document.getElementById("updateBtn");
const updateProgress = document.getElementById("updateProgress");
const latestVersionText = document.getElementById("latestVersionText");

const changelogScreen = document.getElementById("changelogScreen");
const changelogOkBtn = document.getElementById("changelogOkBtn");

// Bannerda sürümü göster
latestVersionText.textContent = LATEST_VERSION;

// Kullanıcı bir kere güncellemiş mi kontrol et
const updated = localStorage.getItem("nova_updated");

function checkForUpdate() {
  if(LATEST_VERSION !== CURRENT_VERSION && !updated){
    updateBanner.style.display = "block"; // Bannerı göster
  }
}

// Güncelleme butonu
updateBtn.addEventListener("click", () => {
  updateBtn.textContent = "Yükleniyor...";
  let progress = 0;

  const interval = setInterval(() => {
    progress += Math.random()*3; // daha yavaş ve uzun
    if(progress >= 100) progress = 100;
    updateProgress.style.width = progress + "%";

    if(progress === 100){
      clearInterval(interval);
      // Kullanıcının artık tekrar görmemesi için işaretle
      localStorage.setItem("nova_updated", "true");

      // Bannerı gizle
      updateBanner.style.display = "none";

      // Changelog ekranını göster
      changelogScreen.style.display = "block";
    }
  }, 150);
});

// Tamam butonu
changelogOkBtn.addEventListener("click", () => {
  changelogScreen.style.display = "none";
});

window.addEventListener("DOMContentLoaded", checkForUpdate);



</script>

</body>
</html>
